# 要件定義書 - KUYOU (黒歴史供養プラットフォーム)

## 1. 目的

KUYOUは、誰もが持つ「消し去りたい過去（黒歴史）」を匿名で共有し、コミュニティの知恵と共感によって「最高の思い出」に変えることで、失敗を恐れずに挑戦できる優しい世界の実現を目指すiOSアプリケーションです。

### 1.1 ビジョン

- 失敗体験を価値ある学びに変換する
- 匿名性により心理的安全性を確保
- コミュニティの力で個人の悩みを解決
- 笑いと学びを通じた心の癒し

## 2. 機能要件

### 2.1 必須機能（MVP）

- [ ] **ユーザー認証・登録機能**
  - メールアドレスとパスワードによる認証
  - 匿名性を保つためのニックネーム自動生成機能
  - セッション管理
  - パスワードリセット機能

- [ ] **黒歴史投稿機能（懺悔の間）**
  - テキストベースの投稿（最大1000文字）
  - 匿名ニックネームの自動割り当て
  - 投稿時のカテゴリ選択（恋愛、仕事、学生時代、etc.）
  - 下書き保存機能
  - 投稿後の編集・削除権限（投稿者のみ）

- [ ] **タイムライン表示機能（供養の広場）**
  - 新着順での投稿表示
  - ページネーション（10件/ページ）
  - カテゴリフィルタリング
  - 供養数（いいね数）による人気順ソート

- [ ] **供養機能（木魚ボタン）**
  - ワンタップで供養（いいね）
  - 供養数のリアルタイム反映
  - 連続タップ制限（1投稿あたり1回まで）
  - 供養時の視覚的フィードバック（木魚音＋アニメーション）

- [ ] **リライト案投稿機能（智慧の泉）**
  - 各黒歴史に対する改善案の投稿
  - リライト案の文字数制限（500文字）
  - リライト案への供養機能
  - 投稿者への通知

- [ ] **ベストアンサー認定機能（成仏の儀）**
  - 黒歴史投稿者によるベストアンサー選択
  - 成仏済み投稿の特別表示
  - 成仏後のタイムラインからの自動削除
  - 成仏通知機能

- [ ] **徳ポイントシステム**
  - ポイント付与ルール
    - 黒歴史投稿: 10ポイント
    - 供養を受ける: 1ポイント/回
    - リライト案投稿: 5ポイント
    - ベストアンサー選出: 50ポイント（投稿者）
    - ベストアンサー獲得: 30ポイント（リライト者）
  - ユーザーランキング表示
  - ポイント履歴確認機能

### 2.2 オプション機能（将来実装）

- [ ] **涅槃堂（成仏済み投稿アーカイブ）**
  - 成仏済み投稿の閲覧専用ページ
  - 学びのライブラリとして活用

- [ ] **画像投稿対応**
  - 黒歴史に関連する画像のアップロード
  - 画像の自動モザイク処理

- [ ] **AI による不適切コンテンツ検出**
  - 投稿前の自動スクリーニング
  - 誹謗中傷、個人情報の自動検出

- [ ] **通報・ブロック機能**
  - 不適切なコンテンツの通報
  - 特定ユーザーのブロック

- [ ] **プッシュ通知**
  - リライト案受信通知
  - ベストアンサー選出通知

## 3. 非機能要件

### 3.1 パフォーマンス

- APIレスポンス時間: 95%ile < 200ms
- タイムライン読み込み: < 1秒
- 同時接続ユーザー数: 1000人以上対応
- 画像アップロード: 最大5MB/枚

### 3.2 セキュリティ

- HTTPS通信の必須化
- パスワードのハッシュ化（bcrypt）
- SQLインジェクション対策
- XSS対策
- CSRF対策
- レート制限（API: 100req/分）
- 匿名性の確保（ユーザー特定情報の非表示）

### 3.3 保守性

- コードカバレッジ: 80%以上
- APIドキュメント（Swagger）の整備
- ログ出力とモニタリング
- エラーハンドリングの統一化
- 12 Factor App準拠

### 3.4 互換性

- iOS: 15.0以上
- API: RESTful JSON形式
- 文字コード: UTF-8

## 4. 制約事項

### 4.1 技術的制約

- **Backend**
  - Ruby 3.2.2
  - Rails 7.0.8（API mode）
  - MySQL 8.0
  - Docker & Docker Compose必須

- **iOS**
  - SwiftUI
  - iOS 15.0+
  - Xcode 14.0+

- **インフラ**
  - 開発環境: Docker
  - APIドキュメント: Swagger UI (port 8080)

### 4.2 ビジネス制約

- ハッカソン期間内での実装（2日間）
- 最小限の機能でのMVPリリース
- 匿名性の絶対的保証
- 日本語のみ対応
- iOSアプリのみ（Web版なし）

## 5. 成功基準

### 5.1 完了の定義

- [ ] 7つの必須機能がすべて実装されている
- [ ] iOSアプリとAPIが正常に連携している
- [ ] 基本的なユーザーフローが完結している
- [ ] エラー処理が適切に実装されている
- [ ] APIドキュメントが整備されている

### 5.2 受け入れテスト

- ユーザー登録から黒歴史投稿までの一連の流れが完了できる
- 投稿された黒歴史に供養とリライト案が付けられる
- ベストアンサー選出により投稿が成仏する
- 徳ポイントが正しく計算・表示される
- 5人以上の同時利用でも正常動作する

## 6. 想定されるリスク

### 6.1 技術的リスク

- **リアルタイム更新の実装難易度**
  - 対策: 初期はポーリングで実装、WebSocket は後回し

- **不適切コンテンツの投稿**
  - 対策: 初期は事後通報制、NGワードフィルタの実装

- **パフォーマンス問題**
  - 対策: キャッシュ戦略の導入、N+1問題の回避

### 6.2 運用リスク

- **匿名性悪用による荒らし行為**
  - 対策: IPアドレスベースの制限、レート制限

- **個人情報の意図しない露出**
  - 対策: 投稿前の注意喚起、ガイドライン整備

## 7. 今後の検討事項

### 7.1 設計フェーズで詳細化すべき事項

- データベーススキーマの詳細設計
- API エンドポイントの詳細仕様
- 認証・認可の実装方式
- キャッシュ戦略
- エラーコード体系

### 7.2 実装フェーズでの注意点

- iOS Human Interface Guidelinesの遵守
- SwiftUIベストプラクティスの適用
- アクセシビリティへの配慮
- 国際化対応の準備（i18n）
- A/Bテストの仕組み

### 7.3 リリース後の展開

- ユーザーフィードバックの収集体制
- 継続的なセキュリティアップデート
- スケーラビリティの確保
- マネタイズ戦略の検討

## 8. 用語定義

- **黒歴史**: ユーザーが恥ずかしいと感じる過去の失敗体験
- **供養**: 投稿への共感や応援を示すアクション（いいね機能）
- **成仏**: ベストアンサーが選ばれ、投稿が完結すること
- **徳ポイント**: ユーザーの貢献度を示すポイント
- **懺悔の間**: 黒歴史投稿ページ
- **供養の広場**: タイムラインページ
- **智慧の泉**: リライト案投稿機能
- **涅槃堂**: 成仏済み投稿のアーカイブ（将来実装）